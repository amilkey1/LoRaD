---
title: "lorad-GTR-vignette"
output: rmarkdown::html_vignette
bibliography: GTR.bib 
vignette: >
  %\VignetteIndexEntry{lorad-GTR-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In this vignette, we explain how one can use this program for calculating the marginal likelihood using GTR model and having simplex for data.

# Data

The data was run through the GTR+I+G model. This model has X parameters which includes alpha(shape parameter of gamma), edgelength propottions(proportions of tree height), er(exchangeability rate), pi(base frequency), and pinvar(proportion of invariable sites).

# Model

The GTR model has unequal base frequencies which leads to all six substitution types being different. This model uses simplex data and all the rows need to add up to one or else there will be an error messages. For example, the simplex columns will be named U1 through U4, one for every base. U1 will be a parameter and U2 through U4 will be variables that will be transformed with respect to U1. Rate heterogeneity is modeled under a +I (proportion of invariable sites) and +G (gamma function where alpha is the shape parameter).

# Reading in Data

First, load the lorad package.

```{r}
library(lorad)
```

Read in the file containing the posterior sample.

```{r}
params <- read.table('posterior_samples.log', header=TRUE)

# Dimensions of params
dim(params)

# Column names of params
colnames(params)
```

# Column Specification 

Next, we must create a named vector to associate each column name in `params` with a column specification. Here are the possible column specifications:

* **iteration**: The MCMC iteration
* **posterior**: The values in this column are components of the posterior (log scale)
* **positive**: The parameter has non-negative support $[0,\infty)$
* **unconstrained**: The parameter has support $(-\infty,\infty)$
* **simplex**: The parameter has support $(0,1)$
* **simplexfinal**: The last simplex parameter has support $(0,1)$
* **proportion**: The parameter has support $(0,1)$
* **ignore**: The column should be ignored

All columns labeled **posterior** will be summed to create the log posterior kernel (sum of log likelihood and log joint prior). 

Here are the column specifications appropriate for this example.

| Column     | Specification |
| :--------: | :-----------: |
| Iteration  |  iteration    |
| Posterior  |  posterior    |
| Likelihood |  ignore       |
| Prior      |  ignore       |
| alpha      | positive   |
| edgelen    | positive   |
| edge_length_proportions.1 | simplex |
| edge_length_proportions.2 | simplex |
| edge_length_proportions.3 | simplex |
| edge_length_proportions.4 | simplex |
| edge_length_proportions.5 | simplex |
| edge_length_proportions.6 | simplex |
| edge_length_proportions.7 | simplexfinal |
| edgelens.1 | ignore |
| edgelens.2 | ignore |
| edgelens.3 | ignore |
| edgelens.4 | ignore |
| edgelens.5 | ignore |
| edgelens.6 | ignore |
| edgelens.7 | ignore |
| er.1 | simplex |
| er.2 | simplex |
| er.3 | simplex |
| er.4 | simplex |
| er.5 | simplex |
| er.6 | simplexfinal |
|pi.1 | simplex |
|pi.2 | simplex |
|pi.3 | simplex |
|pi.4 | simplexfinal |
| pinvar | proportion |
| site_rates.1 | ignore |  
| site_rates.2 | ignore |  
| site_rates.3 | ignore |  
| site_rates.4 | ignore | 
| tree_length | positive |

```{r}
# Create a named vector holding the column specifications
colspec <- c("Iteration"="iteration", "Posterior"="posterior", "Likelihood"="ignore", "Prior"="ignore", "alpha"="iteration", "edge_length_proportions.1."="simplex", "edge_length_proportions.2."="simplex", "edge_length_proportions.3."="simplex", "edge_length_proportions.4."="simplex", "edge_length_proportions.5."="simplex", "edge_length_proportions.6."="simplex", "edge_length_proportions.7."="simplexfinal", "edgelens.1."="ignore", "edgelens.2."="ignore", "edgelens.3."="ignore", "edgelens.4."="ignore", "edgelens.5."="ignore", "edgelens.6."="ignore", "edgelens.7."="ignore", "er.1."="simplex", "er.2."="simplex", "er.3."="simplex", "er.4."="simplex", "er.5."="simplex", "er.6."="simplexfinal", "pi.1."="simplex", "pi.2."="simplex", "pi.3."="simplex", "pi.4."="simplexfinal", "pinvar"="proportion", "site_rates.1."="ignore", "site_rates.2."="ignore", "site_rates.3."="ignore", "site_rates.4."="ignore", "tree_length"="positive")
```

# Computing an Estimate of the Marginal Likelihood

To run the LoRaD function we need to specify the **training fraction**, the **training sample selection method**, and the **coverage fraction**. The training fraction and the coverage fraction must be between 0 and 1. The training sample selection method can be _left_ (the first part of the sample), _right_ (the second part of the sample), or _random_ (a random part of the sample).

For this example we used 0.5 for the training fraction, 0.1 for the coverage fraction, and "left" for the training sample selection method. 

```{r}
lorad_estimate(params, colspec, 0.5, "left", 0.1)
```

The log marginal likelihood is -4440.062373. 
